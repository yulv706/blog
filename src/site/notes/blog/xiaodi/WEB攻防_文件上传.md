---
{"dg-publish":true,"title":"WEB攻防_文件上传","dg-path":"xiaodi/WEB攻防_文件上传.md","permalink":"/xiaodi/WEB攻防_文件上传/","dgPassFrontmatter":true}
---


![Pasted image 20240806112710.png](/img/user/picture/Pasted%20image%2020240806112710.png)

# 前置小提醒

无**文件解析安全问题**上，格式解析是一对一的（不能jpg解析php）

换句话来说**有解析错误配置或后缀解析漏洞时才能实现格式差异解析**



# 概述
文件上传安全指的是攻击者通过利用上传实现后门的写入连接后门进行权限控制的安全问题，对于如何确保这类安全问题，一般会从原生态功能中的**文件内容**，**文件后缀**，**文件类型**等方面判断，但是漏洞可能不仅在本身的代码验证逻辑中出现安全问题，也会在语言版本，语言函数，中间件，引用的**第三方编辑器**等存在缺陷地方配合利用。另外文件上传也有多个**存储逻辑**，不同的文件存储方案也会给攻击者带来不一样的挑战！



# 项目实战

[[blog/安全/靶场/自建环境_文件上传\|自建环境_文件上传]]


# 安全架构

## 目录权限

也就是上传的upload目录没有执行权限

访问403

绕过：如果能把文件上传到别的目录就可以


## 解码还原

也就是这类网站在上传图片的时候会将图片进行编码（常见base64）来存储，显示的时候是将图片进行解码显示
![Pasted image 20240806122742.png](/img/user/picture/Pasted%20image%2020240806122742.png)
这种网站就没有办法将图片当作其他文件来解析



## 分站存储

也就是网站和存储地方不一样


## OSS对象存储

比如阿里云有OSS存储方案，也就是专门提供一个服务器来存储文件

访问这种图片地址的时候一般会进行下载而不是显示


## 安全绕过

以上方案除目录设置权限如能换目录解析绕过外，其他均无解